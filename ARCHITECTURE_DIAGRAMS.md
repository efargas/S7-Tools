# S7Tools System Architecture Diagram

## Overview

This document provides visual representations of the S7Tools architecture, patterns, and component relationships.

---

## 1. Clean Architecture Layers

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         PRESENTATION LAYER                                 â”‚
â”‚                            (S7Tools)                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                        VIEWS (Avalonia XAML)                         â”‚ â”‚
â”‚  â”‚  â€¢ MainWindow.axaml          â€¢ SerialPortsSettingsView.axaml        â”‚ â”‚
â”‚  â”‚  â€¢ LogViewerView.axaml       â€¢ SocatSettingsView.axaml              â”‚ â”‚
â”‚  â”‚  â€¢ HomeView.axaml            â€¢ PowerSupplySettingsView.axaml        â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                     â†•                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                    VIEWMODELS (ReactiveUI)                           â”‚ â”‚
â”‚  â”‚  â€¢ MainWindowViewModel       â€¢ SerialPortsSettingsViewModel         â”‚ â”‚
â”‚  â”‚  â€¢ NavigationViewModel       â€¢ SocatSettingsViewModel               â”‚ â”‚
â”‚  â”‚  â€¢ LogViewerViewModel        â€¢ PowerSupplySettingsViewModel         â”‚ â”‚
â”‚  â”‚  â€¢ BottomPanelViewModel      â€¢ Profile Dialog ViewModels            â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                     â†•                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                    APPLICATION SERVICES                              â”‚ â”‚
â”‚  â”‚  UI Services:                Profile Services:                       â”‚ â”‚
â”‚  â”‚  â€¢ DialogService             â€¢ SerialPortProfileService              â”‚ â”‚
â”‚  â”‚  â€¢ ThemeService              â€¢ SocatProfileService                   â”‚ â”‚
â”‚  â”‚  â€¢ LayoutService             â€¢ PowerSupplyProfileService             â”‚ â”‚
â”‚  â”‚  â€¢ ActivityBarService        (all inherit StandardProfileManager<T>) â”‚ â”‚
â”‚  â”‚  â€¢ UIThreadService                                                   â”‚ â”‚
â”‚  â”‚  â€¢ LocalizationService       Support Services:                       â”‚ â”‚
â”‚  â”‚  â€¢ FileDialogService         â€¢ LogExportService                      â”‚ â”‚
â”‚  â”‚  â€¢ ClipboardService          â€¢ SettingsService                       â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â”‚
                                     â”‚ depends on
                                     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          DOMAIN LAYER                                      â”‚
â”‚                        (S7Tools.Core)                                      â”‚
â”‚                     âŒ ZERO EXTERNAL DEPENDENCIES                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                  INTERFACES & CONTRACTS                              â”‚ â”‚
â”‚  â”‚  Service Interfaces:         Profile Contracts:                      â”‚ â”‚
â”‚  â”‚  â€¢ IUIThreadService          â€¢ IProfileBase                          â”‚ â”‚
â”‚  â”‚  â€¢ IDialogService            â€¢ IProfileManager<T>                    â”‚ â”‚
â”‚  â”‚  â€¢ ISerialPortService        â€¢ ISerialPortProfileService             â”‚ â”‚
â”‚  â”‚  â€¢ ISocatService             â€¢ ISocatProfileService                  â”‚ â”‚
â”‚  â”‚  â€¢ IPowerSupplyService       â€¢ IPowerSupplyProfileService            â”‚ â”‚
â”‚  â”‚  â€¢ ILayoutService                                                    â”‚ â”‚
â”‚  â”‚  â€¢ IThemeService             Command Pattern:                        â”‚ â”‚
â”‚  â”‚  â€¢ ISettingsService          â€¢ ICommand<TOptions, TResult>           â”‚ â”‚
â”‚  â”‚                              â€¢ ICommandHandler<TCommand, TResult>    â”‚ â”‚
â”‚  â”‚                              â€¢ ICommandDispatcher                    â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                     â†•                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                       DOMAIN MODELS                                  â”‚ â”‚
â”‚  â”‚  Profile Models:             Configuration Models:                   â”‚ â”‚
â”‚  â”‚  â€¢ SerialPortProfile         â€¢ SocatConfiguration                    â”‚ â”‚
â”‚  â”‚  â€¢ SocatProfile              â€¢ ModbusTcpConfiguration                â”‚ â”‚
â”‚  â”‚  â€¢ PowerSupplyProfile        â€¢ PowerSupplyConfiguration              â”‚ â”‚
â”‚  â”‚                                                                       â”‚ â”‚
â”‚  â”‚  Value Objects:              Common Models:                          â”‚ â”‚
â”‚  â”‚  â€¢ PlcAddress                â€¢ Result<T>                             â”‚ â”‚
â”‚  â”‚  â€¢ TagValue                  â€¢ ValidationResult                      â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                     â†•                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                  COMMANDS & VALIDATION                               â”‚ â”‚
â”‚  â”‚  Commands:                   Validation:                             â”‚ â”‚
â”‚  â”‚  â€¢ ExportLogsCommand         â€¢ IValidationService                    â”‚ â”‚
â”‚  â”‚  â€¢ ImportLogsCommand         â€¢ IProfileValidator                     â”‚ â”‚
â”‚  â”‚  â€¢ FilterLogsCommand                                                 â”‚ â”‚
â”‚  â”‚  â€¢ ClearLogsCommand                                                  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â†‘
                                     â”‚ depends on
                                     â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      INFRASTRUCTURE LAYER                                  â”‚
â”‚                (S7Tools.Infrastructure.Logging)                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                  CUSTOM LOGGING PROVIDER                             â”‚ â”‚
â”‚  â”‚  â€¢ DataStoreLoggerProvider   â†’ ILoggerProvider (MEL)                â”‚ â”‚
â”‚  â”‚  â€¢ DataStoreLogger           â†’ ILogger (MEL)                         â”‚ â”‚
â”‚  â”‚  â€¢ LogDataStore              â†’ ILogDataStore                         â”‚ â”‚
â”‚  â”‚                                                                       â”‚ â”‚
â”‚  â”‚  Features:                                                           â”‚ â”‚
â”‚  â”‚  âœ“ In-memory circular buffer (bounded to 10,000 entries)            â”‚ â”‚
â”‚  â”‚  âœ“ Thread-safe with ConcurrentQueue                                 â”‚ â”‚
â”‚  â”‚  âœ“ Real-time UI integration                                         â”‚ â”‚
â”‚  â”‚  âœ“ Structured logging support                                       â”‚ â”‚
â”‚  â”‚  âœ“ Observable changes for reactive UI                               â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     CROSS-CUTTING CONCERNS                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ Dependency       â”‚  â”‚ Logging          â”‚  â”‚ Configuration       â”‚    â”‚
â”‚  â”‚ Injection        â”‚  â”‚ (MEL + Custom)   â”‚  â”‚ (JSON + Services)   â”‚    â”‚
â”‚  â”‚                  â”‚  â”‚                  â”‚  â”‚                     â”‚    â”‚
â”‚  â”‚ Microsoft.       â”‚  â”‚ ILogger<T>       â”‚  â”‚ appsettings.json    â”‚    â”‚
â”‚  â”‚ Extensions.DI    â”‚  â”‚ Structured logs  â”‚  â”‚ SettingsService     â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ Thread Safety    â”‚  â”‚ Error Handling   â”‚  â”‚ Memory Management   â”‚    â”‚
â”‚  â”‚                  â”‚  â”‚                  â”‚  â”‚                     â”‚    â”‚
â”‚  â”‚ SemaphoreSlim    â”‚  â”‚ Try-Finally      â”‚  â”‚ IDisposable         â”‚    â”‚
â”‚  â”‚ ConcurrentQueue  â”‚  â”‚ Structured logs  â”‚  â”‚ Circular buffers    â”‚    â”‚
â”‚  â”‚ IUIThreadService â”‚  â”‚ Domain rules     â”‚  â”‚ GC.SuppressFinalize â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. MVVM Pattern Flow

```
USER INTERACTION â†’ VIEW â†’ VIEWMODEL â†’ SERVICE â†’ REPOSITORY â†’ DATA
                    â†“       â†“          â†“         â†“            â†“
                  XAML   ReactiveUI  DI-injected Thread-safe  JSON
                Binding  RaiseAnd    Async/Await Semaphore   Files
                         SetIf
                         Changed

NOTIFICATION FLOW:
DATA â†’ REPOSITORY â†’ SERVICE â†’ VIEWMODEL â†’ VIEW â†’ USER
  â†“                              â†‘          â†‘
JSON File                  INotifyProperty  Data
Change                     Changed          Binding

Example Flow (Create Profile):

1. User clicks "Create" button in View
   â†“
2. Button Command binding triggers ViewModel.CreateCommand
   â†“
3. ViewModel validates and calls ProfileService.CreateAsync()
   â†“
4. ProfileService (StandardProfileManager<T>) acquires semaphore
   â†“
5. Service validates business rules (unique name, default profile logic)
   â†“
6. Service assigns ID, sets timestamps, saves to JSON file
   â†“
7. Service releases semaphore and returns new profile
   â†“
8. ViewModel updates Profiles ObservableCollection
   â†“
9. RaiseAndSetIfChanged triggers property notification
   â†“
10. View's DataGrid updates via data binding
   â†“
11. User sees new profile in the list
```

---

## 3. Profile Management Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    UNIFIED PROFILE MANAGEMENT                        â”‚
â”‚                                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚              IProfileBase (Entity Interface)                   â”‚  â”‚
â”‚  â”‚                                                                 â”‚  â”‚
â”‚  â”‚  + int Id                    â† Unique identifier               â”‚  â”‚
â”‚  â”‚  + string Name               â† Display name                    â”‚  â”‚
â”‚  â”‚  + string Description        â† User description                â”‚  â”‚
â”‚  â”‚  + DateTime CreatedAt        â† Audit trail                     â”‚  â”‚
â”‚  â”‚  + DateTime ModifiedAt       â† Audit trail                     â”‚  â”‚
â”‚  â”‚  + bool IsDefault            â† Default profile flag            â”‚  â”‚
â”‚  â”‚  + bool IsReadOnly           â† System profile protection       â”‚  â”‚
â”‚  â”‚                                                                 â”‚  â”‚
â”‚  â”‚  + bool CanModify()          â† Business rule                   â”‚  â”‚
â”‚  â”‚  + bool CanDelete()          â† Business rule                   â”‚  â”‚
â”‚  â”‚  + string GetSummary()       â† Display representation          â”‚  â”‚
â”‚  â”‚  + IProfileBase Clone()      â† Duplication support             â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                              â†‘ implements                            â”‚
â”‚                              â”‚                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚SerialPort    â”‚  â”‚Socat         â”‚  â”‚PowerSupply        â”‚         â”‚
â”‚  â”‚Profile       â”‚  â”‚Profile       â”‚  â”‚Profile            â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚                              â”‚                                       â”‚
â”‚                              â†“ managed by                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚        IProfileManager<T> (Repository Interface)               â”‚  â”‚
â”‚  â”‚                                                                 â”‚  â”‚
â”‚  â”‚  CRUD Operations:                                              â”‚  â”‚
â”‚  â”‚  â€¢ Task<T> CreateAsync(T profile)                             â”‚  â”‚
â”‚  â”‚  â€¢ Task<T> UpdateAsync(T profile)                             â”‚  â”‚
â”‚  â”‚  â€¢ Task<bool> DeleteAsync(int id)                             â”‚  â”‚
â”‚  â”‚  â€¢ Task<IReadOnlyList<T>> GetAllAsync()                       â”‚  â”‚
â”‚  â”‚  â€¢ Task<T?> GetByIdAsync(int id)                              â”‚  â”‚
â”‚  â”‚                                                                 â”‚  â”‚
â”‚  â”‚  Domain Operations:                                            â”‚  â”‚
â”‚  â”‚  â€¢ Task<T> DuplicateAsync(int sourceId, string newName)       â”‚  â”‚
â”‚  â”‚  â€¢ Task<T> SetDefaultAsync(int id)                            â”‚  â”‚
â”‚  â”‚  â€¢ Task<bool> ExistsAsync(int id)                             â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                              â†‘ implements                            â”‚
â”‚                              â”‚                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚    StandardProfileManager<T> (Base Implementation)             â”‚  â”‚
â”‚  â”‚                                                                 â”‚  â”‚
â”‚  â”‚  Thread Safety:                                                â”‚  â”‚
â”‚  â”‚  â€¢ SemaphoreSlim _semaphore = new(1, 1)                       â”‚  â”‚
â”‚  â”‚  â€¢ Internal method pattern to prevent deadlocks                â”‚  â”‚
â”‚  â”‚                                                                 â”‚  â”‚
â”‚  â”‚  Business Rules:                                               â”‚  â”‚
â”‚  â”‚  â€¢ Unique name enforcement (auto-suffix: Name, Name (2), ...)â”‚  â”‚
â”‚  â”‚  â€¢ Gap-filling ID assignment (fills deleted IDs)               â”‚  â”‚
â”‚  â”‚  â€¢ Single default profile enforcement                          â”‚  â”‚
â”‚  â”‚  â€¢ Read-only profile protection                                â”‚  â”‚
â”‚  â”‚  â€¢ Audit trail maintenance (CreatedAt/ModifiedAt)              â”‚  â”‚
â”‚  â”‚                                                                 â”‚  â”‚
â”‚  â”‚  Persistence:                                                  â”‚  â”‚
â”‚  â”‚  â€¢ JSON file storage (~/.config/S7Tools/profiles/)            â”‚  â”‚
â”‚  â”‚  â€¢ Automatic directory creation                                â”‚  â”‚
â”‚  â”‚  â€¢ Error recovery (corrupt file â†’ create new)                  â”‚  â”‚
â”‚  â”‚  â€¢ Lazy loading (load on first access)                         â”‚  â”‚
â”‚  â”‚                                                                 â”‚  â”‚
â”‚  â”‚  Abstract Methods (subclass must implement):                   â”‚  â”‚
â”‚  â”‚  â€¢ protected abstract T CreateSystemDefault()                  â”‚  â”‚
â”‚  â”‚  â€¢ protected abstract string ProfileTypeName { get; }          â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                              â†‘ inherits                              â”‚
â”‚                              â”‚                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚SerialPort    â”‚  â”‚Socat         â”‚  â”‚PowerSupply        â”‚         â”‚
â”‚  â”‚ProfileServiceâ”‚  â”‚ProfileServiceâ”‚  â”‚ProfileService     â”‚         â”‚
â”‚  â”‚              â”‚  â”‚              â”‚  â”‚                   â”‚         â”‚
â”‚  â”‚+ Create      â”‚  â”‚+ Create      â”‚  â”‚+ Create           â”‚         â”‚
â”‚  â”‚  SystemDefaultâ”‚  â”‚  SystemDefaultâ”‚  â”‚  SystemDefault    â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

BENEFITS OF THIS ARCHITECTURE:
âœ“ Zero code duplication (all CRUD in base class)
âœ“ Consistent behavior across all profile types
âœ“ Thread-safe by design (semaphore in base class)
âœ“ Business rules enforced uniformly
âœ“ Easy to add new profile types (inherit and implement 2 methods)
âœ“ Testable (interface-based design)
```

---

## 4. Threading and Synchronization Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    THREADING ARCHITECTURE                            â”‚
â”‚                                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                        UI THREAD                               â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚  Avalonia Dispatcher.UIThread                            â”‚  â”‚  â”‚
â”‚  â”‚  â”‚                                                           â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  Responsibilities:                                        â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ UI rendering and updates                              â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ Event handling (button clicks, etc.)                  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ Data binding notifications                            â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ XAML element manipulation                             â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â”‚                           â†•                                    â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚  IUIThreadService (Abstraction)                          â”‚  â”‚  â”‚
â”‚  â”‚  â”‚                                                           â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ Task InvokeAsync(Action action)                       â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ Task<T> InvokeAsync<T>(Func<T> function)              â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ bool IsOnUIThread { get; }                            â”‚  â”‚  â”‚
â”‚  â”‚  â”‚                                                           â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  Implementation: AvaloniaUIThreadService                 â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ Checks if already on UI thread                        â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ Marshals if needed via Dispatcher                     â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                   BACKGROUND THREADS                           â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚  ThreadPool (via Task.Run)                               â”‚  â”‚  â”‚
â”‚  â”‚  â”‚                                                           â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  Responsibilities:                                        â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ I/O operations (file, network)                        â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ Heavy computations                                    â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ Async service operations                              â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ Profile persistence                                   â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â”‚                           â†•                                    â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚  SemaphoreSlim (Synchronization)                         â”‚  â”‚  â”‚
â”‚  â”‚  â”‚                                                           â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  Usage Pattern:                                          â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ Protects shared profile collections                   â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ Ensures atomic operations                             â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ Internal method pattern prevents deadlocks            â”‚  â”‚  â”‚
â”‚  â”‚  â”‚                                                           â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  Public API:                                             â”‚  â”‚  â”‚
â”‚  â”‚  â”‚    await _semaphore.WaitAsync(ct);                       â”‚  â”‚  â”‚
â”‚  â”‚  â”‚    try { return await InternalAsync(); }                 â”‚  â”‚  â”‚
â”‚  â”‚  â”‚    finally { _semaphore.Release(); }                     â”‚  â”‚  â”‚
â”‚  â”‚  â”‚                                                           â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  Internal Helper:                                        â”‚  â”‚  â”‚
â”‚  â”‚  â”‚    // NO semaphore - assumes already held                â”‚  â”‚  â”‚
â”‚  â”‚  â”‚    private async Task InternalAsync() { ... }            â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚             THREAD-SAFE COLLECTIONS                            â”‚  â”‚
â”‚  â”‚  â€¢ ConcurrentQueue<LogModel> (log data store)                 â”‚  â”‚
â”‚  â”‚  â€¢ Protected List<T> with SemaphoreSlim (profile managers)    â”‚  â”‚
â”‚  â”‚  â€¢ ObservableCollection<T> (UI bindings - UI thread only)     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                 ASYNC/AWAIT PATTERNS                           â”‚  â”‚
â”‚  â”‚                                                                 â”‚  â”‚
â”‚  â”‚  Library Code (Services, Repositories):                        â”‚  â”‚
â”‚  â”‚    await operation.ConfigureAwait(false)                       â”‚  â”‚
â”‚  â”‚    â€¢ Doesn't capture synchronization context                   â”‚  â”‚
â”‚  â”‚    â€¢ Better performance                                        â”‚  â”‚
â”‚  â”‚    â€¢ Prevents deadlocks                                        â”‚  â”‚
â”‚  â”‚                                                                 â”‚  â”‚
â”‚  â”‚  UI Code (ViewModels with UI updates):                         â”‚  â”‚
â”‚  â”‚    await _uiThreadService.InvokeAsync(() => UpdateUI())        â”‚  â”‚
â”‚  â”‚    â€¢ Explicit UI thread marshaling                             â”‚  â”‚
â”‚  â”‚    â€¢ Clear intent                                              â”‚  â”‚
â”‚  â”‚                                                                 â”‚  â”‚
â”‚  â”‚  Reactive Subscriptions:                                       â”‚  â”‚
â”‚  â”‚    this.WhenAnyValue(x => x.Prop)                              â”‚  â”‚
â”‚  â”‚        .ObserveOn(RxApp.MainThreadScheduler)                   â”‚  â”‚
â”‚  â”‚        .Subscribe(...)                                         â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

CRITICAL PATTERNS DOCUMENTED IN systemPatterns.md:

1. Internal Method Pattern (prevents semaphore deadlocks)
   âœ“ Public methods acquire semaphore
   âœ“ Internal helpers assume semaphore held
   âœ“ No nested semaphore acquisition

2. Debug Logging for Async Operations
   âœ“ Log "ğŸ”’ Waiting for semaphore..."
   âœ“ Log "ğŸ”“ Semaphore acquired"
   âœ“ Log "ğŸ”“ Releasing semaphore..."
   âœ“ Helps track async flow timeline

3. ConfigureAwait(false) in Library Code
   âœ“ All service layer uses ConfigureAwait(false)
   âœ“ Prevents SynchronizationContext capture
   âœ“ Better performance and safety
```

---

## 5. Logging Infrastructure Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      LOGGING INFRASTRUCTURE                              â”‚
â”‚                                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚              Microsoft.Extensions.Logging (MEL)                     â”‚ â”‚
â”‚  â”‚                      ILoggerFactory                                 â”‚ â”‚
â”‚  â”‚                           â”‚                                         â”‚ â”‚
â”‚  â”‚                           â”œâ”€â†’ Console Provider                      â”‚ â”‚
â”‚  â”‚                           â”œâ”€â†’ Debug Provider                        â”‚ â”‚
â”‚  â”‚                           â””â”€â†’ DataStore Provider (Custom) âœ¨        â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                  â†“                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚              DataStoreLoggerProvider (Custom)                       â”‚ â”‚
â”‚  â”‚                                                                      â”‚ â”‚
â”‚  â”‚  â€¢ Implements ILoggerProvider (MEL interface)                       â”‚ â”‚
â”‚  â”‚  â€¢ Creates DataStoreLogger instances per category                   â”‚ â”‚
â”‚  â”‚  â€¢ Manages lifecycle and disposal                                   â”‚ â”‚
â”‚  â”‚  â€¢ Configurable via DataStoreLoggerConfiguration                    â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                  â†“                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                   DataStoreLogger (Custom)                          â”‚ â”‚
â”‚  â”‚                                                                      â”‚ â”‚
â”‚  â”‚  â€¢ Implements ILogger (MEL interface)                               â”‚ â”‚
â”‚  â”‚  â€¢ Formats log entries with category, level, message                â”‚ â”‚
â”‚  â”‚  â€¢ Supports structured logging (scopes, properties)                 â”‚ â”‚
â”‚  â”‚  â€¢ Writes to ILogDataStore                                          â”‚ â”‚
â”‚  â”‚  â€¢ Thread-safe via internal locking                                 â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                  â†“                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚              ILogDataStore â†’ LogDataStore                           â”‚ â”‚
â”‚  â”‚                                                                      â”‚ â”‚
â”‚  â”‚  Storage:                                                           â”‚ â”‚
â”‚  â”‚    â€¢ ConcurrentQueue<LogModel> _entries                            â”‚ â”‚
â”‚  â”‚    â€¢ Thread-safe lock-free queue                                    â”‚ â”‚
â”‚  â”‚    â€¢ Bounded size (MaxEntries = 10,000 default)                     â”‚ â”‚
â”‚  â”‚    â€¢ Circular buffer behavior                                       â”‚ â”‚
â”‚  â”‚                                                                      â”‚ â”‚
â”‚  â”‚  Operations:                                                        â”‚ â”‚
â”‚  â”‚    â€¢ AddEntry(LogModel) - adds and maintains size                   â”‚ â”‚
â”‚  â”‚    â€¢ GetEntries() - returns snapshot                                â”‚ â”‚
â”‚  â”‚    â€¢ Clear() - removes all entries                                  â”‚ â”‚
â”‚  â”‚    â€¢ Observable<LogModel> Entries - real-time stream                â”‚ â”‚
â”‚  â”‚                                                                      â”‚ â”‚
â”‚  â”‚  Features:                                                          â”‚ â”‚
â”‚  â”‚    âœ“ Automatic old entry removal (FIFO)                             â”‚ â”‚
â”‚  â”‚    âœ“ No unbounded memory growth                                     â”‚ â”‚
â”‚  â”‚    âœ“ High performance (concurrent queue)                            â”‚ â”‚
â”‚  â”‚    âœ“ Observable for reactive UI updates                             â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                  â†“                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                    LOG VIEWER (UI Integration)                      â”‚ â”‚
â”‚  â”‚                                                                      â”‚ â”‚
â”‚  â”‚  LogViewerViewModel:                                                â”‚ â”‚
â”‚  â”‚    â€¢ Subscribes to ILogDataStore.Entries observable                 â”‚ â”‚
â”‚  â”‚    â€¢ Receives real-time log updates                                 â”‚ â”‚
â”‚  â”‚    â€¢ Marshals to UI thread via IUIThreadService                     â”‚ â”‚
â”‚  â”‚    â€¢ Filters by level, category, search text                        â”‚ â”‚
â”‚  â”‚    â€¢ Exports logs to file (JSON, CSV, TXT)                          â”‚ â”‚
â”‚  â”‚                                                                      â”‚ â”‚
â”‚  â”‚  LogViewerView:                                                     â”‚ â”‚
â”‚  â”‚    â€¢ DataGrid with virtualization                                   â”‚ â”‚
â”‚  â”‚    â€¢ Color-coded log levels                                         â”‚ â”‚
â”‚  â”‚    â€¢ Real-time auto-scroll option                                   â”‚ â”‚
â”‚  â”‚    â€¢ Column visibility toggles                                      â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

USAGE PATTERN:

// 1. Service registration
services.AddS7ToolsLogging(options =>
{
    options.MaxEntries = 10000;  // Circular buffer size
    options.MinLevel = LogLevel.Information;
});

// 2. Service usage (constructor injection)
public class SomeService
{
    private readonly ILogger<SomeService> _logger;
    
    public SomeService(ILogger<SomeService> logger)
    {
        _logger = logger;
    }
    
    public async Task DoWorkAsync()
    {
        _logger.LogInformation("ğŸ”§ Starting work");
        
        try
        {
            var result = await PerformAsync();
            _logger.LogInformation("âœ“ Work completed: {Result}", result);
        }
        catch (Exception ex)
        {
            _logger.LogError(ex, "âœ— Work failed");
            throw;
        }
    }
}

// 3. UI viewing
The LogViewer automatically displays all logs in real-time
Users can filter, search, and export logs

BENEFITS:
âœ“ Real-time UI integration
âœ“ Bounded memory (circular buffer)
âœ“ Thread-safe (ConcurrentQueue)
âœ“ Structured logging support
âœ“ Observable for reactive updates
âœ“ Multiple output formats (JSON, CSV, TXT)
âœ“ Integrates with standard MEL
```

---

## 6. Service Registration and Dependency Injection

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 DEPENDENCY INJECTION ARCHITECTURE                  â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                    Program.cs (Entry Point)                  â”‚  â”‚
â”‚  â”‚                                                               â”‚  â”‚
â”‚  â”‚  var builder = new ServiceCollection();                      â”‚  â”‚
â”‚  â”‚                                                               â”‚  â”‚
â”‚  â”‚  // âœ“ Modular registration via extension methods             â”‚  â”‚
â”‚  â”‚  builder.AddS7ToolsServices(options =>                       â”‚  â”‚
â”‚  â”‚  {                                                            â”‚  â”‚
â”‚  â”‚      options.MaxEntries = 10000;                             â”‚  â”‚
â”‚  â”‚  });                                                          â”‚  â”‚
â”‚  â”‚                                                               â”‚  â”‚
â”‚  â”‚  var services = builder.BuildServiceProvider();              â”‚  â”‚
â”‚  â”‚                                                               â”‚  â”‚
â”‚  â”‚  // âœ“ Initialize services that need async setup              â”‚  â”‚
â”‚  â”‚  await services.InitializeS7ToolsServicesAsync();            â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                              â†“                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚        ServiceCollectionExtensions (Central Registry)        â”‚  â”‚
â”‚  â”‚                                                               â”‚  â”‚
â”‚  â”‚  AddS7ToolsServices()                                        â”‚  â”‚
â”‚  â”‚    â”œâ”€â†’ AddS7ToolsFoundationServices()                       â”‚  â”‚
â”‚  â”‚    â”‚     â”œâ”€ IUIThreadService â†’ AvaloniaUIThreadService      â”‚  â”‚
â”‚  â”‚    â”‚     â”œâ”€ ILayoutService â†’ LayoutService                  â”‚  â”‚
â”‚  â”‚    â”‚     â”œâ”€ IThemeService â†’ ThemeService                    â”‚  â”‚
â”‚  â”‚    â”‚     â”œâ”€ IDialogService â†’ DialogService                  â”‚  â”‚
â”‚  â”‚    â”‚     â”œâ”€ ISerialPortProfileService â†’ ...                 â”‚  â”‚
â”‚  â”‚    â”‚     â”œâ”€ ISocatProfileService â†’ ...                      â”‚  â”‚
â”‚  â”‚    â”‚     â””â”€ IPowerSupplyProfileService â†’ ...                â”‚  â”‚
â”‚  â”‚    â”‚                                                          â”‚  â”‚
â”‚  â”‚    â”œâ”€â†’ AddS7ToolsAdvancedServices()                         â”‚  â”‚
â”‚  â”‚    â”‚     â”œâ”€ ICommandDispatcher â†’ CommandDispatcher          â”‚  â”‚
â”‚  â”‚    â”‚     â”œâ”€ IViewModelFactory â†’ EnhancedViewModelFactory    â”‚  â”‚
â”‚  â”‚    â”‚     â”œâ”€ IResourceManager â†’ ResourceManager              â”‚  â”‚
â”‚  â”‚    â”‚     â””â”€ IValidationService â†’ ValidationService          â”‚  â”‚
â”‚  â”‚    â”‚                                                          â”‚  â”‚
â”‚  â”‚    â”œâ”€â†’ AddS7ToolsLogging(options)                           â”‚  â”‚
â”‚  â”‚    â”‚     â”œâ”€ ILoggerFactory â†’ Microsoft.Extensions.Logging   â”‚  â”‚
â”‚  â”‚    â”‚     â”œâ”€ ILogDataStore â†’ LogDataStore                    â”‚  â”‚
â”‚  â”‚    â”‚     â””â”€ DataStoreLoggerProvider                         â”‚  â”‚
â”‚  â”‚    â”‚                                                          â”‚  â”‚
â”‚  â”‚    â””â”€â†’ AddS7ToolsViewModels()                               â”‚  â”‚
â”‚  â”‚          â”œâ”€ MainWindowViewModel                              â”‚  â”‚
â”‚  â”‚          â”œâ”€ NavigationViewModel                              â”‚  â”‚
â”‚  â”‚          â”œâ”€ LogViewerViewModel                               â”‚  â”‚
â”‚  â”‚          â””â”€ Profile ViewModels (Serial, Socat, Power)        â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                              â†“                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚              Service Lifetimes & Best Practices              â”‚  â”‚
â”‚  â”‚                                                               â”‚  â”‚
â”‚  â”‚  Singleton (single instance for app lifetime):               â”‚  â”‚
â”‚  â”‚    âœ“ UI services (Layout, Theme, ActivityBar)               â”‚  â”‚
â”‚  â”‚    âœ“ Profile services (shared state)                        â”‚  â”‚
â”‚  â”‚    âœ“ Logging infrastructure                                 â”‚  â”‚
â”‚  â”‚    âœ“ Configuration services                                 â”‚  â”‚
â”‚  â”‚    âœ“ Main ViewModels (navigation state)                     â”‚  â”‚
â”‚  â”‚                                                               â”‚  â”‚
â”‚  â”‚  Transient (new instance per request):                       â”‚  â”‚
â”‚  â”‚    âœ“ Dialog services (short-lived)                          â”‚  â”‚
â”‚  â”‚    âœ“ Dialog ViewModels                                      â”‚  â”‚
â”‚  â”‚    âœ“ Profile dialog ViewModels                              â”‚  â”‚
â”‚  â”‚    âœ“ Export services                                        â”‚  â”‚
â”‚  â”‚                                                               â”‚  â”‚
â”‚  â”‚  Scoped (not used in desktop app):                           â”‚  â”‚
â”‚  â”‚    âœ— Not applicable (no request scope)                       â”‚  â”‚
â”‚  â”‚                                                               â”‚  â”‚
â”‚  â”‚  Registration Pattern:                                       â”‚  â”‚
â”‚  â”‚    services.TryAddSingleton<IService, Implementation>();    â”‚  â”‚
â”‚  â”‚              â†‘                                                â”‚  â”‚
â”‚  â”‚              TryAdd prevents duplicate registration           â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                              â†“                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                Service Initialization                         â”‚  â”‚
â”‚  â”‚                                                               â”‚  â”‚
â”‚  â”‚  InitializeS7ToolsServicesAsync(IServiceProvider):           â”‚  â”‚
â”‚  â”‚    â€¢ Loads layout configuration                              â”‚  â”‚
â”‚  â”‚    â€¢ Loads theme configuration                               â”‚  â”‚
â”‚  â”‚    â€¢ Initializes profile storage (background)                â”‚  â”‚
â”‚  â”‚    â€¢ Creates default profiles if needed                      â”‚  â”‚
â”‚  â”‚    â€¢ Handles errors gracefully                               â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                              â†“                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                   Service Consumption                         â”‚  â”‚
â”‚  â”‚                                                               â”‚  â”‚
â”‚  â”‚  // Constructor injection (preferred)                        â”‚  â”‚
â”‚  â”‚  public class MainWindowViewModel                            â”‚  â”‚
â”‚  â”‚  {                                                            â”‚  â”‚
â”‚  â”‚      private readonly IDialogService _dialogService;         â”‚  â”‚
â”‚  â”‚      private readonly ILogger _logger;                       â”‚  â”‚
â”‚  â”‚                                                               â”‚  â”‚
â”‚  â”‚      public MainWindowViewModel(                             â”‚  â”‚
â”‚  â”‚          IDialogService dialogService,                       â”‚  â”‚
â”‚  â”‚          ILogger<MainWindowViewModel> logger)                â”‚  â”‚
â”‚  â”‚      {                                                        â”‚  â”‚
â”‚  â”‚          _dialogService = dialogService;                     â”‚  â”‚
â”‚  â”‚          _logger = logger;                                   â”‚  â”‚
â”‚  â”‚      }                                                        â”‚  â”‚
â”‚  â”‚  }                                                            â”‚  â”‚
â”‚  â”‚                                                               â”‚  â”‚
â”‚  â”‚  // Service locator (for special cases only)                 â”‚  â”‚
â”‚  â”‚  var service = serviceProvider.GetRequiredService<IService>();â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

BENEFITS:
âœ“ Central registration (ServiceCollectionExtensions only)
âœ“ Modular configuration (foundation, advanced, logging, ViewModels)
âœ“ No registration in Program.cs (follows guideline)
âœ“ Proper lifetimes (Singleton/Transient)
âœ“ TryAdd pattern prevents duplicates
âœ“ Constructor injection throughout
âœ“ Interface-based (testability and flexibility)
```

---

## Summary

This architecture demonstrates:

1. **Clean Architecture** - Proper dependency flow, domain isolation
2. **MVVM Pattern** - Clear separation with ReactiveUI
3. **DDD Principles** - Rich domain models, business rules, repositories
4. **Thread Safety** - SemaphoreSlim, concurrent collections, IUIThreadService
5. **Custom Logging** - MEL integration with real-time UI
6. **Dependency Injection** - Central registration, proper lifetimes
7. **Unified Profile Management** - Zero duplication via base class
8. **Async/Await Best Practices** - ConfigureAwait, cancellation, internal methods

**Result:** A production-ready, maintainable, and testable codebase with excellent separation of concerns and adherence to .NET best practices.

