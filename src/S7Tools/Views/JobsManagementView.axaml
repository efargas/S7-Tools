<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="using:S7Tools.ViewModels"
             xmlns:converters="using:S7Tools.Converters"
             mc:Ignorable="d" d:DesignWidth="800" d:DesignHeight="600"
             x:Class="S7Tools.Views.JobsManagementView"
             x:DataType="vm:JobsManagementViewModel">

  <Design.DataContext>
    <vm:JobsManagementViewModel />
  </Design.DataContext>

  <Grid RowDefinitions="Auto,*,Auto" ColumnDefinitions="*">

  <!-- Header Section -->
  <Border Grid.Row="0" Grid.ColumnSpan="1" Background="{DynamicResource SystemRegionBrush}"
            BorderBrush="{DynamicResource SystemBaseLowBrush}" BorderThickness="0,0,0,1" Padding="16,12">
      <Grid ColumnDefinitions="*,Auto">

        <!-- Title and Search -->
        <StackPanel Grid.Column="0" Orientation="Horizontal" Spacing="16">
          <TextBlock Text="Job Management" FontWeight="SemiBold" FontSize="18"
                     VerticalAlignment="Center" />
          <TextBox Watermark="Search jobs..." Text="{Binding SearchText}"
                   Width="200" VerticalAlignment="Center" />
        </StackPanel>

  <!-- Action Buttons -->
  <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="8"
            IsVisible="{Binding IsWizardMode, Converter={x:Static converters:BooleanConverters.Not}}">
    <Button Content="Create (Wizard)" Command="{Binding StartWizardCommand}"
                  ToolTip.Tip="Create a new job profile using the wizard" />
    <Button Content="Edit" Command="{Binding StartWizardFromSelectedCommand}"
      ToolTip.Tip="Open wizard prefilled from selected job" />
          <Button Content="Duplicate" Command="{Binding DuplicateCommand}"
                  ToolTip.Tip="Duplicate the selected job profile" />
          <Button Content="Delete" Command="{Binding DeleteCommand}"
                  ToolTip.Tip="Delete the selected job profile" />
        </StackPanel>
      </Grid>
    </Border>

    <!-- Main Content - Wizard or Job Profile List -->
    <Grid Grid.Row="1" Grid.Column="0" Margin="16" RowDefinitions="*,Auto">

      <!-- Wizard Content -->
      <Border Grid.Row="0" Background="#252526" Padding="12" CornerRadius="6">
        <ContentControl
                      IsVisible="{Binding IsWizardMode}"
                      Content="{Binding WizardVM}" />
      </Border>

      <!-- Jobs DataGrid -->
  <DataGrid Grid.Row="0" IsVisible="{Binding IsWizardMode, Converter={x:Static converters:BooleanConverters.Not}}"
                ItemsSource="{Binding Profiles}"
                SelectedItem="{Binding SelectedProfile}"
                IsReadOnly="True" CanUserReorderColumns="False" CanUserResizeColumns="True"
                GridLinesVisibility="Horizontal" HeadersVisibility="Column"
                AutoGenerateColumns="False">
        <DataGrid.Columns>
          <DataGridTextColumn Header="ID" Binding="{Binding Id}" Width="60" />
          <DataGridTextColumn Header="Name" Binding="{Binding Name}" Width="200" />
          <DataGridTextColumn Header="Description" Binding="{Binding Description}" Width="300" />
          <DataGridTextColumn Header="Serial Profile" Binding="{Binding SerialProfileId}" Width="100" />
          <DataGridTextColumn Header="Socat Profile" Binding="{Binding SocatProfileId}" Width="100" />
          <DataGridTextColumn Header="Power Profile" Binding="{Binding PowerSupplyProfileId}" Width="100" />
          <DataGridTextColumn Header="Created" Binding="{Binding CreatedAt, StringFormat='MM/dd/yyyy'}" Width="100" />
          <DataGridTextColumn Header="Modified" Binding="{Binding ModifiedAt, StringFormat='MM/dd/yyyy'}" Width="100" />
          <DataGridCheckBoxColumn Header="Default" Binding="{Binding IsDefault}" Width="70" />
          <DataGridCheckBoxColumn Header="Template" Binding="{Binding IsTemplate}" Width="80" />
        </DataGrid.Columns>
      </DataGrid>

      <!-- Job Details Panel -->
  <Expander Grid.Row="1" Header="Job Details" IsExpanded="True" Margin="0,16,0,0"
                IsVisible="{Binding IsWizardMode, Converter={x:Static converters:BooleanConverters.Not}}">
        <Border Classes="InfoCard">
          <Grid ColumnDefinitions="*,*" RowDefinitions="Auto,Auto,Auto,Auto,Auto,Auto">

            <!-- Basic Information -->
            <TextBlock Grid.Row="0" Grid.Column="0" Classes="InfoHeader" Text="Basic Information" />
            <Grid Grid.Row="1" Grid.Column="0" Classes="InfoList" RowDefinitions="Auto,Auto,Auto" ColumnDefinitions="Auto,*">
              <TextBlock Grid.Row="0" Grid.Column="0" Classes="InfoLabel" Text="Name:" />
              <TextBlock Grid.Row="0" Grid.Column="1" Classes="InfoValue" Text="{Binding SelectedProfile.Name}" />
              <TextBlock Grid.Row="1" Grid.Column="0" Classes="InfoLabel" Text="Description:" />
              <TextBlock Grid.Row="1" Grid.Column="1" Classes="InfoValue" Text="{Binding SelectedProfile.Description}" />
              <TextBlock Grid.Row="2" Grid.Column="0" Classes="InfoLabel" Text="Version:" />
              <TextBlock Grid.Row="2" Grid.Column="1" Classes="InfoValue" Text="{Binding SelectedProfile.Version}" />
            </Grid>

            <!-- Profile References -->
            <TextBlock Grid.Row="0" Grid.Column="1" Classes="InfoHeader" Text="Profile References" />
            <Grid Grid.Row="1" Grid.Column="1" Classes="InfoList" RowDefinitions="Auto,Auto,Auto" ColumnDefinitions="Auto,*">
              <TextBlock Grid.Row="0" Grid.Column="0" Classes="InfoLabel" Text="Serial Profile ID:" />
              <TextBlock Grid.Row="0" Grid.Column="1" Classes="InfoValue" Text="{Binding SelectedProfile.SerialProfileId}" />
              <TextBlock Grid.Row="1" Grid.Column="0" Classes="InfoLabel" Text="Socat Profile ID:" />
              <TextBlock Grid.Row="1" Grid.Column="1" Classes="InfoValue" Text="{Binding SelectedProfile.SocatProfileId}" />
              <TextBlock Grid.Row="2" Grid.Column="0" Classes="InfoLabel" Text="Power Supply ID:" />
              <TextBlock Grid.Row="2" Grid.Column="1" Classes="InfoValue" Text="{Binding SelectedProfile.PowerSupplyProfileId}" />
            </Grid>

            <!-- Memory Configuration -->
            <TextBlock Grid.Row="2" Grid.Column="0" Classes="InfoHeader" Text="Memory Configuration" />
            <Grid Grid.Row="3" Grid.Column="0" Classes="InfoList" RowDefinitions="Auto,Auto" ColumnDefinitions="Auto,*">
              <TextBlock Grid.Row="0" Grid.Column="0" Classes="InfoLabel" Text="Start Address:" />
              <TextBlock Grid.Row="0" Grid.Column="1" Classes="InfoValue" Text="{Binding SelectedProfile.MemoryRegion.Start, StringFormat='0x{0:X8}'}" />
              <TextBlock Grid.Row="1" Grid.Column="0" Classes="InfoLabel" Text="Size:" />
              <TextBlock Grid.Row="1" Grid.Column="1" Classes="InfoValue" Text="{Binding SelectedProfile.MemoryRegion.Length, StringFormat='0x{0:X} bytes'}" />
            </Grid>

            <!-- Timing Configuration -->
            <TextBlock Grid.Row="2" Grid.Column="1" Classes="InfoHeader" Text="Timing Configuration" />
            <Grid Grid.Row="3" Grid.Column="1" Classes="InfoList" RowDefinitions="Auto,Auto" ColumnDefinitions="Auto,*">
              <TextBlock Grid.Row="0" Grid.Column="0" Classes="InfoLabel" Text="Power On Time:" />
              <TextBlock Grid.Row="0" Grid.Column="1" Classes="InfoValue" Text="{Binding SelectedProfile.PowerOnTimeMs, StringFormat='{}{0} ms'}" />
              <TextBlock Grid.Row="1" Grid.Column="0" Classes="InfoLabel" Text="Power Off Delay:" />
              <TextBlock Grid.Row="1" Grid.Column="1" Classes="InfoValue" Text="{Binding SelectedProfile.PowerOffDelayMs, StringFormat='{}{0} ms'}" />
            </Grid>

            <!-- Payload Configuration -->
            <TextBlock Grid.Row="4" Grid.Column="0" Classes="InfoHeader" Text="Payload Configuration" />
            <Grid Grid.Row="5" Grid.Column="0" Classes="InfoList" RowDefinitions="Auto,Auto" ColumnDefinitions="Auto,*">
              <TextBlock Grid.Row="0" Grid.Column="0" Classes="InfoLabel" Text="Payloads Path:" />
              <TextBlock Grid.Row="0" Grid.Column="1" Classes="InfoValue" Text="{Binding SelectedProfile.Payloads.BasePath}" />
              <TextBlock Grid.Row="1" Grid.Column="0" Classes="InfoLabel" Text="Output Path:" />
              <TextBlock Grid.Row="1" Grid.Column="1" Classes="InfoValue" Text="{Binding SelectedProfile.OutputPath}" />
            </Grid>

            <!-- Status Information -->
            <TextBlock Grid.Row="4" Grid.Column="1" Classes="InfoHeader" Text="Status Information" />
            <Grid Grid.Row="5" Grid.Column="1" Classes="InfoList" RowDefinitions="Auto,Auto,Auto" ColumnDefinitions="Auto,*">
              <TextBlock Grid.Row="0" Grid.Column="0" Classes="InfoLabel" Text="Created:" />
              <TextBlock Grid.Row="0" Grid.Column="1" Classes="InfoValue" Text="{Binding SelectedProfile.CreatedAt, StringFormat='MM/dd/yyyy HH:mm'}" />
              <TextBlock Grid.Row="1" Grid.Column="0" Classes="InfoLabel" Text="Modified:" />
              <TextBlock Grid.Row="1" Grid.Column="1" Classes="InfoValue" Text="{Binding SelectedProfile.ModifiedAt, StringFormat='MM/dd/yyyy HH:mm'}" />
              <TextBlock Grid.Row="2" Grid.Column="0" Classes="InfoLabel" Text="Flags:" />
              <StackPanel Grid.Row="2" Grid.Column="1" Orientation="Horizontal" Spacing="8">
                  <Border Background="{DynamicResource SystemAccentBrush}" CornerRadius="12" Padding="6,2"
                          IsVisible="{Binding SelectedProfile.IsDefault}">
                    <TextBlock Text="Default" Foreground="{DynamicResource SystemAltHighBrush}" FontSize="10" />
                  </Border>
                  <Border Background="{DynamicResource SystemBaseMediumBrush}" CornerRadius="12" Padding="6,2"
                          IsVisible="{Binding SelectedProfile.IsTemplate}">
                    <TextBlock Text="Template" Foreground="{DynamicResource SystemAltHighBrush}" FontSize="10" />
                  </Border>
                  <Border Background="{DynamicResource SystemBaseLowBrush}" CornerRadius="12" Padding="6,2"
                          IsVisible="{Binding SelectedProfile.IsReadOnly}">
                    <TextBlock Text="Read-Only" Foreground="{DynamicResource SystemBaseHighBrush}" FontSize="10" />
                  </Border>
                </StackPanel>
            </Grid>
          </Grid>
        </Border>
      </Expander>
    </Grid>

  <!-- Status Bar -->
  <Border Grid.Row="2" Grid.ColumnSpan="1" Background="{DynamicResource SystemRegionBrush}"
            BorderBrush="{DynamicResource SystemBaseLowBrush}" BorderThickness="0,1,0,0" Padding="16,8">
      <Grid ColumnDefinitions="*,Auto,Auto">
        <TextBlock Grid.Column="0" Text="{Binding StatusMessage}"
                   Foreground="{DynamicResource SystemBaseMediumBrush}" FontSize="12" />
                      <TextBlock Grid.Column="1" Text="{Binding AllJobs.Count, StringFormat='{}{0} jobs'}"
                   Foreground="{DynamicResource SystemBaseMediumBrush}" FontSize="12" Margin="0,0,16,0" />
        <StackPanel Grid.Column="2" Orientation="Horizontal" Spacing="8">
          <TextBlock Text="Has Changes:" Foreground="{DynamicResource SystemBaseMediumBrush}" FontSize="12" />
          <Border Background="Green" CornerRadius="6" Width="12" Height="12" />
        </StackPanel>
      </Grid>
    </Border>

  </Grid>
</UserControl>
